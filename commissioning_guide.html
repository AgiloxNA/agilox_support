<!DOCTYPE html>
<head>
    <link rel="stylesheet" href="main.css">
  </head> 
<body>
  <nav id="navbar">
    <header>
      <a href="index.html"><img src="images/agilox-white.svg" id="logo"></a>
      <h1 id="nav-title">
        AGILOX ONE Commissioning Guide
      </h1>
    </header>
    <div id="nav-links">
      <a href="#introduction" class="nav-link">Introduction</a>
      <a href="#initial-setup" class="nav-link">Initial Setup</a>
      <a href="#lidar-installation" class="nav-link">LiDAR Installation</a>
      <a href="#powering-on" class="nav-link">Powering On</a>
      <a href="#maintenance-mode" class="nav-link">Maintenance Mode</a>
      <a href="#manual-mode" class="nav-link">Manual Mode</a>
      <a href="#creating-the-map" class="nav-link">Creating the Map</a>
      <a href="#auto-teach-function" class="nav-link">Auto-Teach Function</a>
      <a href="#inkscape-configuration" class="nav-link">Inkscape Configuration</a>
      <a href="#drawing-with-inkscape" class="nav-link">Drawing with Inkscape</a>
      <a href="#basic-hmi-features" class="nav-link">Basic HMI Features</a>
      <a href="#stations-and-workflows" class="nav-link">Stations and Workflows</a>
      <a href="#station-settings" class="nav-link">Station Settings</a>
      <a href="#create-charging-station" class="nav-link">Create a Charging Station</a>
      <a href="#simple-workflow-example" class="nav-link">Simple Workflow Example</a>
      <a href="#advanced-workflow-topics" class="nav-link">Advanced Workflow Topics</a>
    </div>
    <div id="contact">
    Contact:<br>
      <span id="email">jacob.dunn@agilox.net<br>sonny.bucci@agilox.net</span>
    </div>
  </nav>
  
  <main id="main-doc">
    <section class="main-section" id="introduction">
      <header>
        <h1>
          Introduction
        </h1>
      </header>
      <p>
        Before following any of the setup instructions in this guide, it is critical that the following conditions have been satisfied:
      </p>
      <ul>
          <li>Suitable WiFi network infrastructure is in place, operational, and accessible (i.e. you have the password and can connect to the network freely). See our WiFi requirements here.</li>
          <li>A charger and charging plate have been installed. Operating in automatic mode with no available charging stations will cause unpredictable behavior. See  charger info here.</li>
          <li>All operators and responsible personnel have read and understood the safety precautions in the Operation Manual.</li>
      </ul>
    </section>
    <section class="main-section" id="initial-setup">
      <header>
        <h1>
          Initial Setup
        </h1>
      </header>
      <p>
        You will need the following items to successfully prepare the AGILOX ONE for operation:
      </p>
      <div class="twocolumn">
      <ul>
        <li>4mm hex key</li>
        <li>#5 double-bit enclosure key / panel key</li>
        <li>WiFi-enabled laptop, tablet, or smartphone</li>
        <li>For unpacking: a forklift or crane, a drill or impact gun with a #30 Torx bit to disassemble the crate, and a 19mm wrench to remove shipping braces.</li>
      </ul>
      <img src="images/toolpic.jpg" class="twocolumnpic">
    </div>
    </section>
    <section class="main-section" id="lidar-installation">
      <header>
        <h1>
          LiDAR Installation
        </h1>
      </header>
      <p>
        There is a detailed unloading and unpacking guide in section 4 of the Operation Manual, but there is not much to it - you can begin by removing all the screws and supports from the crate, but try to preserve these materials as much as possible in case you need to send a unit back for any reason. Using the provided shackle and strap, lift the unit off of the base with a forklift, then pull the base of the crate out from under the unit, and finally set the unit down on the floor.
      </p>
      <p>
        Every AGILOX unit is shipped with its LIDAR navigation sensor in a separate box to minimize the possibility of damage during transport. This sensor is somewhat delicate (and very expensive to replace), so please use extreme caution when handling it. Included in the LIDAR box are 3 screws and washers. If the screws are already threaded into the holes in the bottom of the sensor, remove them and set aside for now. To install the sensor, first unlock the lid on top by turning the lock counterclockwise with your panel key and then flip the lid open, as shown below:
      </p>
      <div class="squarepicsdiv">
        <img src="images/lidarpic1.jpg" id="lidarpic1" class="squarepic">
        <img src="images/lidarpic2.jpg" id="lidarpic2" class="squarepic">
      </div>
      <p>
        Remove the green cover by pulling straight up, and then towards you. Near the LIDAR mounting platform on the left side, you can see 2 cables for power (grey) and LAN (green). Attach the cables as shown below. Each connector is keyed so that it can only be installed in one direction, which could be different from what you see here. No tools are required - don't use anything more than finger-tight force, or you could damage the connectors.
      </p>
      <div class="squarepicsdiv">
        <img src="images/lidarpic3.jpg" id="lidarpic3" class="squarepic">
        <img src="images/lidarpic4.jpg" id="lidarpic4" class="squarepic">
      </div>
      <p>
        When mounting the sensor, it's important to note that there are 2 raised pins on the mounting platform, which should slide into 2 mounting points on the bottom of the sensor (picture on the left below). When everything is properly aligned and seated, the sensor should sit flush with the mounting platform:
      </p>
      <div class="squarepicsdiv">
        <img src="images/lidarpic5.jpg" id="lidarpic5" class="squarepic">
        <img src="images/lidarpic6.jpg" id="lidarpic6" class="squarepic">
      </div>
      <p>
        Now, secure the sensor with the 3 screws through the holes in the bottom of the mounting plate, using your 4mm hex key:
      </p>
      <div class="squarepicsdiv">
        <img src="images/lidarpic7.jpg" id="lidarpic7" class="squarepic">
      </div>
      <p>
        With the 3 screws firmly in place, replace the green cover, then close and lock the lid on top. The green cover has 2 tabs on each side and one in the center at the bottom. Ensure that all of these are properly in place before closing the lid. And finally, before locking the lid, ensure the black and blue wires for the antennas are pushed back and clear of the locking mechanism.
      </p>
      <div class="squarepicsdiv">
        <img src="images/lidarpic8.jpg" id="lidarpic8" class="threepicsmall">
        <img src="images/lidarpic9.jpg" id="lidarpic9" class="threepicsmall">
        <img src="images/lidarpic10.jpg" id="lidarpic10" class="threepicsmall">
      </div>
    </section>
    <section class="main-section" id="powering-on">
      <header>
        <h1>
          Powering On
        </h1>
      </header>
      <div class="twocolumn">
        <p>
          Before you can turn the unit on, you must turn on all of the breakers which are turned off to protect the battery during shipping. To do this, first remove the front panel with your panel key by turning the lock counter-clockwise. When you unlock the panel, it will rock back and come to a rest in this slightly open position seen here on the left. You can then remove this panel by pulling straight up, and gently set it aside.
        </p>
        <img src="images/powerpic1.jpg" id="powerpic1" class="twocolumnpic">
      </div>
      <div class="twocolumn">
        <p>
          Behind this panel, there are 3 groups of breakers that need to be turned on. Below you can see the left-most breaker from each group in the off/down position for reference, with all the others being ON. Flip ALL breakers to the on/up position.
        </p>
        <img src="images/powerpic2.jpg" id="powerpic2" class="twocolumnpic">
      </div>
      <div class="squarepicsdiv">
        <img src="images/powerpic3.jpg" id="powerpic3" class="threepicsmall">
        <img src="images/powerpic4.jpg" id="powerpic4" class="threepicsmall">
        <img src="images/powerpic5.jpg" id="powerpic5" class="threepicsmall">
      </div>
      <p>
        Now replace and lock the front panel, and the unit is ready to be powered on. Turn the key switch on the unit's shoulder counter-clockwise all the way to the left (maintenance mode), and then turn the power switch clockwise to the "|" symbol and let go.
      </p>
      <div class="squarepicsdiv">
        <img src="images/powerpic6.jpg" id="powerpic6" class="squarepic">
      </div>
    </section>
    <section class="main-section" id="maintenance-mode">
      <header>
        <h1>
          Maintenance Mode
        </h1>
      </header>
      <p>
        Before an AGILOX unit can create or join a Union (group of units that share information with each other),  the WiFi network information must be loaded into the unit in maintenance mode. After powering on, the unit will take a minute or two to boot up. Once the boot process is complete, the Acknowledge button opposite from the power and mode switches will light up. Once the blue light is on, press the Acknowledge button. The Start button will light up shortly after that, and again, press the Start button once it is illuminated. Now the LED indicators along each side of the unit should be flashing yellow to indicate it is in maintenance mode.
      </p>
      <div class="squarepicsdiv">
        <img src="images/maintpic1.jpg" id="maintpic1" class="squarepic">
        <img src="images/maintpic2.jpg" id="maintpic2" class="squarepic">
      </div>
      <p>
        You can now also see some information displayed by the LIDAR sensor on top: the unit's serial number and IP address. When in maintenance mode, every unit will create a WiFi hotspot which has the same name as the unit's serial number. The password for this hotspot is also the same as the name, the unit's serial number. Connect your laptop or other WiFi device to this new hotspot, and type in the serial number for the password. Once you have done this, open your web browser and type in the IP address shown in the bottom row of the LIDAR sensor's display in the address bar.
      </p>
      <div class="squarepicsdiv">
        <img src="images/maintpic3.jpg" id="maintpic3" class="squarepic">
      </div>
      <p>
        After navigating to the IP address shown by the unit, you should see a basic HMI screen. There is not much to see yet, and in order to make any changes you will have to log in by clicking the last button on the left. The default login for customers is <b>admin</b> and password also <b>admin</b>. Later you can change this password and add other user accounts with varying levels of access, but for now we will leave it as is.
      </p>
      <div class="squarepicsdiv">
        <img src="images/maintpic4.jpg" id="maintpic4" class="squarepic">
      </div>
      <p>
        After logging in, you can now see the full suite of HMI control groups on the left hand side. Some quick notes about the HMI: You can always click the AGILOX logo in the top left corner to return to this view. Also, everything that you do in the HMI is updated on the unit in real time. With few exceptions, there are no save or upload/download buttons, and almost all activities you can perform in the browser window become effective immediately.
      </p>
      <div class="squarepicsdiv">
        <img src="images/maintpic5.jpg" id="maintpic5" class="squarepic">
      </div>
      <p>
        Now, hold down both the Start and Acknowledge buttons at the same time until you hear a chime (about 6 seconds). After you hear the tone, you will see a new button on the HMI screen - a gear icon with an orange background.
      </p>
      <div class="squarepicsdiv">
        <img src="images/maintpic6.jpg" id="maintpic6" class="squarepic">
        <img src="images/maintpic7.jpg" id="maintpic7" class="squarepic">
      </div>
      <div class="twocolumn">
        <div>
          <h2>
            Union Setup
          </h2>
          <p>
            Click on the orange gear icon, and you will be prompted to enter the name of the Union you want to connect this unit to. This name can be anything you want for the first unit, but if there are already existing units that you want this one to collaborate with, the Union name must be exactly the same as the one used by the other units (case sensitive). When finished, press the check mark to continue.
          </p>
        </div>
        <img src="images/maintpic8.jpg" id="maintpic8" class="twocolumnpic">
      </div>
      <div class="twocolumn">
        <div>
          <h2>
            WiFi Setup
          </h2>
          <p>
            Next, select the WiFi network you would like to connect this unit to. After selecting the network, enter the password you used to connect to that network.
          </p>
        </div>
        <img src="images/maintpic9.jpg" id="maintpic9" class="twocolumnpic">
      </div>
      <div class="twocolumn">
        <div>
          <h2>
            IP Type
          </h2>
          <p>
            After entering the WiFi information, you will be presented with the choice of a DHCP or Static IP address. For testing purposes, DHCP is the quickest way to get going, but a static IP is preferred for long term operation. Another option is to create DHCP reservations for each unit, if you prefer to leave them in DHCP mode. In either case, your IT department must modify the WiFi network configuration to ensure that each unit has a permanent IP address which will not change. Leaving the units in either mode without appropriately configuring the network can eventually lead to network dropouts, IP address conflicts, and other unpredictable behavior. 
          </p>
        </div>
        <img src="images/maintpic10.jpg" id="maintpic10" class="twocolumnpic">
      </div>
      <p>
        That's it! If this unit is joining an existing Union, you can flip the key switch over to Automatic mode, press the Start button, and in a few moments the unit will download the map and work order information from the other units and begin working right away.
      </p>
      <p>
        If this is the very first unit being set up, continue to the next section for more information on operating the unit in Manual mode, which we will need later to create the map.
      </p>
    </section>
    <section class="main-section" id="manual-mode">
      <header>
        <h1>
          Manual Mode
        </h1>
      </header>
      <div class="twocolumn">
        <div>
          <p>
            Now that the initial setup is complete, we can begin operating the unit in Manual mode. To start, turn the key switch to the Manual mode position in the center ( || symbol ). The start button will illuminate, and in order to confirm the mode change you must press the start button. When ready, the LED indicators on the side of the unit will be flashing blue to indicate Manual Mode.
          </p>
        </div>
        <img src="images/manualpic1.jpg" id="manualpic1" class="twocolumnpic">
      </div>
      <div class="twocolumn">
        <div>
          <p>
            After switching to Manual mode, the hotspot that you were connected to while the unit was in Maintenance mode will be switched off. The unit will now be connected to the WiFi network that you configured in the last step, which means that you can no longer use the HMI from the same IP address as before. First connect your device to the same WiFi network you configured in the previous section. Then press and release the Start button 3 times as shown in the animation to the right.
          </p>
          <p>
            The unit will again show its serial number and IP address on the LIDAR sensor at the top of the unit, but now the IP address should be different than the one you saw in Maintenance Mode. As you did in the previous section, type this IP address into your browser and log in to the admin account.
          </p>
        </div>
        <img src="images/manualpic2.jpg" id="manualpic2" class="twocolumnpic">
      </div>
      <p class="paragraph-break">
        The primary use for Manual Mode is the "Manual Drive" function, which can be found by clicking the second button from the top on the left side of the HMI screen.
      </p>
      <img src="images/manualpic3.jpg" id="manualpic3" class="fullsizepic">
      <p>
        This screen allows you to drive the unit manually in any direction. Click or tap and hold the white dot in the center, then drag in the direction you would like to move, as shown. When you let go, the unit will stop immediately. Keep in mind that, while all of the safety fields are active in Manual Mode, it may be possible to manually drive the unit into a position it can't get out of. If this happens, you can also use this screen in Maintenance Mode to drive with the safety fields deactivated. However, manual driving in maintenance mode also requires that you hold down the acknowledge (blue) button on the unit to enable the driving controls. There is no safety active when driving in maintenance mode, so the acknowledge button acts as a "dead man switch."
      </p>
      <p>
        The other items at the corners of this screen enable some additional functionality:
      </p>
      <ol>
        <li>Enables raising/lowering the lift system. Note that lowering the forks requires a very wide safety field: if the forks will not go down, try driving to a more open area first.</li>
        <li>Enables parallel driving in any direction, without turning.</li>
        <li>Activates the teaching function, used to create the map.</li>
        <li>Allows station entering. In order to manually pick up a pallet or parallel drive through a very narrow aisle, this option must be selected. But, watch your feet with this option selected, as it disables a portion of the safety field near the fork tips.</li>
      </ol>
      <p>
        In the next section, we will be creating map the using the button next to number #3.
      </p>
    </section>
    <section class="main-section" id="creating-the-map">
      <header>
        <h1>
          Creating the Map
        </h1>
      </header>
      <p>
        Items required for this section:
      </p>
      <ul>
        <li>WiFi-enabled laptop (smartphone may also be used for driving)</li>
        <li>The free and open source drawing program Inkscape: <a href="https://inkscape.org/release/inkscape-1.0/" class="main-link">click here to download</a></li>
        <li>At least one active AGILOX vehicle that has been through the <a href="#initial-setup" class="main-link">Initial Setup</a> process</li>
      </ul>
    </section>
    <section class="main-section" id="auto-teach-function">
      <header>
        <h1>
          Auto-Teach Function
        </h1>
      </header>
      <p>
        Before we begin to create the map, use Manual Mode to drive the unit into the intended operating area. It should be parked initially in an area with a clear view of fixed reference points, such as a wall and other structural features of the building which are unobstructed by crates or other materials, and ideally beginning about 20-30 feet away from and facing the center of one of the walls. Below is an example of the driving procedure for the teaching function. It's best to drive in a roughly star-like or saw-tooth pattern as shown, rather than driving in circles along the walls:
      </p>
      <img src="images/teachpic1.jpg" id="teachpic1" class="fullsizepic">
      <p>
        The area shown here is relatively small, and in fact a room this size may be adequately mapped with a single scan, which may not require any driving at all. Note the pattern shown in this example is for illustration purposes and not necessarily to scale. 
      </p>
      <div class="twocolumn">
        <div>
          <p>
            One last thing before you begin: in order to see what you're doing, you will need to enable some visibility options in the HMI. Go the second button up from the bottom on the left hand side (Visualization Toggles) and select "Show scan data in visualization" and "Show map in visualization" (the two highlighted in green here).
          </p>
          <p>
            The scan data option will show you dark and light blue lines, which represent the vision of the floor-level safety scanners, as well as green lines, which show data from the navigation scanner on top. The show map option will show black lines which represent the reference points that have been taught as part of the map. There will not be any black lines just yet, since we have to create them!
          </p>
        </div>
        <img src="images/teachpic2.jpg" id="teachpic2" class="twocolumnpic">
      </div>
      <p class="paragraph-break">
        Now as in the last section, go to the Manual Drive page, and click on the button next to #3 to add a new contour from the navigation scanner.
      </p>
      <img src="images/teachpic3.jpg" id="teachpic3" class="fullsizepic">
      <div class="twocolumn">
        <div>
          <p>
            In the window that pops up, first select "Rectangular Snap" and then click Enable AutoTeach.
          </p>
        </div>
        <img src="images/teachpic4.jpg" id="teachpic4" class="twocolumnpic">
      </div>
      <p class="paragraph-break">
        Now the unit will begin scanning the environment. There are audio-visual cues to let you know that scanning is in progress and when it is done. Begin driving the unit in the mapping pattern shown above. When the navigation match drops below a certain level, it will automatically stop and perform another scan. It's also a good idea to keep an eye on the map as it is being built, so that you can ensure the dimensions of the defined map area can accommodate the scan data - it is helpful here to have your laptop on the map view and use your phone for manual driving. Go to the misc. tools and settings tab in the HMI and click the map settings button, so that a window that looks like this comes up:
      </p>
      <img src="images/teachpic5.jpg" id="teachpic5" class="fullsizepic">
      <p>
        You will have to experiment with the dimensions and offsets to fit the map area into the window the way you want. Note that all of the information that AGILOX captures about the environment is always stored in the map, even if you can't see it. If you start driving and auto-teaching outside of the defined map area, or if you shrink or shift the map in such a way that a previously visible portion disappears, the information will not be lost. You can simply adjust the map until it is visible again - however, anything outside of the defined map area cannot be used for navigation purposes, so the auto-teach process will be faster and more accurate if you keep adjusting the map to contain everything within the visible area.
      </p>
      <p class="paragraph-break">
        When finished mapping: from your computer, go back to the main menu by clicking the AGILOX logo in the top left if you are not already there. For the next step, we need to download the map file that we have created, by clicking the download button on the right hand side. But first, a little cleanup may be necessary.
      </p>
      <p>
        When the "show map" visualization is enabled, you can also see all of the scan points here on the right hand side. You can toggle the visibility of or delete specific map teaching increments here, and by hovering your mouse over the numbers you will see which segments are included in that iteration highlighted in red.
      </p>
      <p>
        Finally, the last button under the visualization toggles tab, "Erase map areas," will allow you delete specific portions of the map. This is useful for removing small sections of erroneous information from the map, such as scan points picked up by people's heads, crates, forklifts, or other temporary obstacles that you don't want to be a part of the permanent map data.
      </p>
      <p>
        When cleanup is finished and the map is properly sized and rotated, download the map file.
      </p>
      <img src="images/teachpic6.jpg" id="teachpic6" class="fullsizepic">
    </section>
    <section class="main-section" id="inkscape-configuration">
      <header>
        <h1>
          Inkscape Configuration
        </h1>
      </header>
      <p>
        To facilitate the processing of AGILOX maps, some menu windows (1) and the color palette from the documentation (2) are required.
      </p>
      <div class="twocolumn">
        <div>
          <h2>
            Settings Menu
          </h2>
          <p>
            The settings of the menus and windows are saved in the file <code>preferences.xml</code> (file can be downloaded below). This file must be copied into the directory for the local Inkscape settings. This directory is usually located under <code>C:\Users\<User>\AppData \Roaming\inkscape</code>
          </p>
          <h2>
            Color Palette
          </h2>
          <p>
            The color palette for the AGILOX standard map colors is saved in the file agilox.gpl (file can be downloaded below). This file is to be copied into the directory for the local customer-specific color palettes from Inkscape. This directory is usually located at <code>C:\Users\<User>\AppData \Roaming\inkscape\palettes</code>
          </p>
          <p>
            <b>After both files have been copied, please restart Inkscape.</b>
          </p>
        </div>
        <img src="images/inkpic1.jpg" id="inkpic1" class="twocolumnpic-bigger">
      </div>
      <div class="twocolumn">
        <div>
          <h2>
            Note
          </h2>
          <p>
            If the AGILOX color palette is not automatically displayed after the restart, then it must be selected manually.
            </p>
          <p>
            By clicking on the arrow on the right edge of the color palette (1), a menu for selecting the color palette <b>AGILOX</b> (2) appears.
          </p>
        </div>
        <img src="images/inkpic2.jpg" id="inkpic2" class="twocolumnpic-bigger">
      </div>
    </section>
    <section class="main-section" id="drawing-with-inkscape">
      <header>
        <h1>
          Drawing with Inkscape
        </h1>
      </header>
      <p>
        Once Inkscape is properly configured, use it to open your map.svg file.
      </p>
      <h2>
        Basic Information and Controls
      </h2>
      <ul>
        <li>Navigation is accomplished with the mouse wheel and middle mouse button. Scrolling the  mouse wheel moves the image up and down, holding down the SHIFT key and scrolling the mouse wheel moves left and right, and holding down the CTRL key and scrolling the mouse wheel zooms in and out. You can also hold down the wheel button (middle click) and move the mouse to pan freely, tap the middle click button to zoom in, and tap the middle click button while holding SHIFT to zoom out. If you are lacking a good middle mouse button, hold down CTRL and use the arrow keys to pan, and use the +/- buttons to zoom in and out.</li>
        <li>When you are sufficiently zoomed in, you can see major and minor grid lines in the background. The minor grid lines represent a real-world distance of 100 mm, and each major grid line is made up of a 5x5 grid of 100 mm square blocks for a total of 0.5 m. When you zoom out, at a certain point the minor grid disappears and you can only see the half-meter blocks.</li>
        <li>There are several layers in the map file (as seen in the bottom right corner) - station, contour, blocked, and general. The only layers you need to work with are blocked and general. <b>Don't try to edit the station or contour layers</b>, as these are automatically generated in and handled by the HMI and are only shown in the map file for reference.</li>
        <li>It is very important to make sure that you are working in the correct layer at all times. The blocked layer is used to draw permanent obstacles in the map, such as walls, shelves, holes in the floor, or generally any area AGILOX should not attempt to drive through. The general layer is used to create everything else - action areas for I/O, one-way lanes, crossing or reduced speed zones, tracks, and many other types of programmable actions.</li>
        <li>The color palette along the bottom is used to give the map a standardized appearance, however, the color has no effect on functionality. You may use any color you wish for any type of area, but keeping the appearance consistent makes it quick and easy for AGILOX technicians to understand your process and make changes if necessary. The most commonly used colors are on the left, and if you hover your mouse over a color swatch you will see the name of the type of area it is used for.</li>
      </ul>
      <img src="images/drawpic1.jpg" id="drawpic1" class="fullsizepic">
      <p>
        Notice that, similar to the picture below, there is a square/rectangle around the map scan data. This is the area that was defined by the map dimensions you entered in the HMI previously. To start, we are going to create a blocked rectangle over this entire defined area. Then we add or cut away parts of this to define the room and the "allowed" areas. The general procedure for creating objects/areas in the map shown below is to (1) ensure the correct layer is selected (blocked in this case), (2) select the rectangle tool at the top left, then (3) choose the color - we will be starting with "blocked" (#e6e6e6).
      </p>
      <img src="images/drawpic2.jpg" id="drawpic2" class="fullsizepic">
      <p>
        Start by covering the defined map area with a blocked rectangle, like this:
      </p>
      <img src="images/drawpic3.jpg" id="drawpic3" class="fullsizepic">
      <div class="twocolumn">
        <div>
          <p>
            If you need to resize the shape, click on the select tool (mouse pointer) just above the rectangle tool, or press S. <b>Press ESC when you are done to clear the selection</b>. Next we will define the room, i.e. the walls and other permanent features of the building, by covering ALL of the walls with another blocked rectangle using the room color.
          </p>
        </div>
        <img src="images/drawpic4.jpg" id="drawpic4" class="twocolumnpic">
      </div>
      <div class="twocolumn">
        <div>
          <p>
            Now we can begin cutting out the sections that don't belong to the room or blocked areas. Draw another rectangle (we will call this the "<b>top</b>" object) over an area that you want to delete , then choose the select tool or press S, so that you see black arrows around the object like this...
          </p>
        </div>
        <img src="images/drawpic5.jpg" id="drawpic5" class="twocolumnpic">
      </div>
      <div class="twocolumn">
        <div>
          <p>
            ...Then, hold down SHIFT and left click on the area you want to cut from, in this case the bigger dark grey "room" rectangle (we will call this the "<b>bottom</b>" object).
          </p>
        </div>
        <img src="images/drawpic6.jpg" id="drawpic6" class="twocolumnpic">
      </div>
      <div class="twocolumn">
        <div>
          <p>
            Now hold CTRL and press the "-" (minus) key. This will subtract the top area from the bottom. This is more or less all you need to know to work with Inkscape for the purposes of this tutorial: make a big object for the bottom which covers everything you want to cover, make another object that covers the area to be deleted on top, select the top object, SHIFT click on the bottom object, press CTRL - to delete. Now you will see something like this:
          </p>
        </div>
        <img src="images/drawpic7.jpg" id="drawpic7" class="twocolumnpic">
      </div>
      <p class="paragraph-break">
        It's also possible to do the opposite of this, by creating two objects and combining them into one. Use the same shift-click procedure as before to select both objects, then hold both the CTRL and SHIFT keys and press "+" to combine. Here is another example:
      </p>
      <div class="squarepicsdiv">
        <img src="images/drawpic8.jpg" id="drawpic8" class="threepicsmall">
        <img src="images/drawpic9.jpg" id="drawpic9" class="threepicsmall">
        <img src="images/drawpic10.jpg" id="drawpic10" class="threepicsmall">
      </div>
      <p>
        Keep going with these techniques to cover only walls, columns, and other permanent features of the building in the dark grey "room" color. Then, use the same techniques to cut away from the light grey "blocked" area to reveal the white background, which is considered free driving area. Some spaces which might remain covered in the light grey area include shelving/racking, work benches, grated floors, pedestrian walkways, or anywhere else driving should not be allowed. From inside the driving area, cover the walls only as much a necessary, then leave an extra 2-3 squares on the outside to ensure visibility, like this:
      </p>
      <img src="images/drawpic11.jpg" id="drawpic11" class="fullsizepic">
      <div class="twocolumn">
        <div>
          <p>
            The example map finished: Walls are dark grey, driving prohibited areas are light grey, and free driving area is the blank white background. Before you go to the next section, add at least one action (yellow) area in the general layer like the one shown here as well - you can always remove it later. If you create an action area in the blocked layer by mistake (or vice versa), you can change the layer of an object by selecting it, right clicking on it, then choose "Move to Layer...", select general, and press move.
          </p>
        </div>
        <img src="images/drawpic12.jpg" id="drawpic12" class="twocolumnpic">
      </div>
      <p class="paragraph-break">
        When finished editing the map, be sure to save the file before closing Inkscape. Now go to your Downloads folder (or wherever you saved the map file), and drag and drop the map file from Windows explorer into the HMI window in your browser. This will automatically update the map for all units in the Union if more than one unit is connected.
      </p>
      <img src="images/drawpic13.jpg" id="drawpic13" class="fullsizepic">
      <img src="images/drawpic14.jpg" id="drawpic14" class="fullsizepic">
    </section>
    <section class="main-section" id="basic-hmi-features">
      <header>
        <h1>
          Basic HMI Features
        </h1>
      </header>
      <p>
        With the map uploaded, there are some additional features to be aware of before we get into creating stations and workflows. When interacting with the map in the HMI, you can right click anywhere (or tap and hold on a touch-screen device) to bring up the Action menu, which will always give you a few actions to perform:
      </p>
      <ul>
        <li><b>Drive to Target:</b> Only used in automatic mode, sends the unit to the desired position automatically.</li>
        <li><b>New Station:</b> Used to create new stations, as well as waypoints and IO links. If you right click in between the forks of an AGILOX vehicle before choosing this option, the new station will be created in the same position and orientation as the vehicle.</li>
        <li><b>New StationArea:</b> Creates a new group name to be used by stations which are all to be considered as a single origin/destination point. For example, when you want to bring one of many identical pallets to a general area of the map, but you don't care which exact station it ends up in.</li>
        <li><b>Multiple Stations Select:</b> Allows you to modify certain properties of or delete multiple stations simultaneously</li>
        <li><b>Force Local Positioning:</b> If the unit appears to be somewhere else on the map, i.e. the HMI shows a different position than the actual location, this is used to force the vehicle position to the location which you right clicked, then the unit will try to figure out the correct position again.</li>
      </ul>
      <p>
        And, if you are right-clicking on a station or action area, there will be some other options in addition to, or instead of, the options mention above:
      </p>
      <ul>
        <li><b>Modify Station: or Modify SVG Element:</b> Opens the properties menu for the selected object, which can also be accessed by double-clicking the station or object instead of going through the right-click action menu.</li>
        <li><b>Drive to Station (only available when right-clicking on stations):</b> Automatically sends the unit to park in the designated station. Only used in Automatic Mode.</li>
      </ul>
      <p>
        You can move stations with the mouse in 50 mm increments after they have been created by holding the SHIFT key, then click and drag the station to move. Similarly, you can also copy stations using the CTRL key. Copied stations inherit all the properties of the parent station, including the name (numbers will be appended at the end automatically to ensure a unique name), station area, allowed load carriers, preposition, etc.
      </p>
      <p class="paragraph-break">
        Now let's take a look at the action area we created in Inkscape. Double-click on the action area,  or right-click and then choose "Modify SVG Element" with the wrench icon. When using the right-click menu you can also now see the action area you selected outlined with a dashed line:
      </p>
      <img src="images/basicpic1.jpg" id="basicpic1" class="fullsizepic">
      <div class="twocolumn">
        <div>
          <p>
            From the properties dialog, the first things you will be able to change are the name of the area and the visibility conditions in the general tab. All of the possible conditions are covered in the Commissioning Manual in section 4.7.5, and with these conditional statements you can choose whether or not the action area will be displayed in the HMI. On the left-hand side are some additional tabs for Flags (Commissioning Manual section 4.5.4.1), Actions (section 4.7.6), and Direction - limiting driving to one-way or only certain directions.
          </p>
        </div>
        <img src="images/basicpic2.jpg" id="basicpic2" class="twocolumnpic">
      </div>
      <div class="twocolumn">
        <div>
          <p>
            Next, notice that you have a tool-tip that appears when you hold the mouse over different areas:
          </p>
        </div>
        <img src="images/basicpic3.jpg" id="basicpic3" class="twocolumnpic-bigger">
      </div>
      <p class="paragraph-break">
        You can use this in conjunction with some additional visualization settings to understand how the path planning and driving dynamics work. In the visualization toggles tab, click on "Show route map in visualization". Here you can see the areas which AGILOX can use to plan routes using a cost-based system. Driving is prohibited in red areas (except when entering a station), and in orange areas driving is allowed, but not rotation - you can also see all of this information in the tool-tips that appear for each area. This will be an important tool in the next section, because stations generally must have their pre-position somewhere in the white space in this view. It can also be useful in the event that AGILOX refuses to drive through a narrow aisle, even though it looks like there should be enough space: if there is not a white-space path to the target, it won't be possible to get there in Automatic mode, so you will have to go back to Inkscape and make corrections to the map.
      </p>
      <img src="images/basicpic4.jpg" id="basicpic4" class="fullsizepic">
      <p>
        Another useful feature is the Heatmap section, the very last button on the HMI in the bottom left:
      </p>
      <img src="images/basicpic5.jpg" id="basicpic5" class="fullsizepic">
      <p>
        Here you have the option to select various heatmaps, including WiFi and 4G reception, position, speed, map quality, etc. If you start having issues later on in the setup process, these can help you understand why.
      </p>
      <p class="paragraph-break">
        And finally, be sure to create regular backups of the software state. Now would be a good time to make the first one, and in the future, make a backup before you start making any changes to the system. Go to the Misc. tools and settings tab and click on "System settings":
      </p>
      <div class="squarepicsdiv">
        <img src="images/basicpic6.jpg" id="basicpic6" class="rectanglepic">
        <img src="images/basicpic7.jpg" id="basicpic7" class="rectanglepic">
      </div>
      <p>
        When you click on the Backup / Restore button, you will be presented with the popup window above on the right. The Data option essentially saves everything about the system that you can change: the map, workflow information, wifi configuration, and any other custom attributes. Software is everything internal to the AGILOX platform: the installed software version, motion controls, IPC state, etc. Keep regular backups of both, and if you ever need to restore one of these files, the upload button is also here.
      </p>
    </section>
    <section class="main-section" id="stations-and-workflows">
      <header>
        <h1>
          Stations and Workflows
        </h1>
      </header>
      <p>
        Items required for this section:
      </p>
      <div class="twocolumn">
        <ul>
            <li>WiFi-enabled laptop</li>
            <li>At least one active AGILOX vehicle that has been through the Initial Setup process, and has a map file from Inkscape uploaded as described in the previous section</li>
            <li>An installed charger</li>
            <li>A euro pallet, cart, or other carrier for testing which has a base that measures 800 x 1200 mm or less</li>
        </ul>
        <img src="images/stationpic1.jpg" class="twocolumnpic-bigger">
      </div>
    </section>
    <section class="main-section" id="station-settings">
      <header>
        <h1>
          Station Settings
        </h1>
      </header>
      <p>
        Now that we've gone over the map and some basic controls and context menus, let's take a deeper look at creating usable stations. When you double click on a station, or right click and select "Modify Station," you will be presented with the menu shown below.
      </p>
      <p>
        The station parameters are open by default, and on the left hand side menu bar (red box) you can find several other menus.
      </p>
      <ol>
        <li><b>Station Parameters (current view):</b> allows you to modify the position, orientation, and driving approach to the station.</li>
        <li><b>Station Options:</b> allows you to set various characteristics of a station, such as whether idle parking is allowed, whether the station can be used for charging, etc.</li>
        <li><b>Load Carrier Settings:</b> here you can select which types of load carriers are valid for this station. You can add custom load carriers to this list in System Settings.</li>
        <li><b>Station Area:</b> defines which station areas this station belongs to. Stations can be a member of multiple areas, and new areas are defined by right-clicking in the map view.</li>
        <li><b>Admin Settings:</b> set custom conditions for station availability and occupation. See section 4.3.2.1 in the Commissioning Manual for full details.</li>
        <li><b>Safety Settings:</b> here you can toggle the Safe Drop(+) features, which extend the use of the safety field during a load drop. See section 6.4.5 in the Operation Manual.</li>
      </ol>
      <img src="images/stationsetpic1.jpg" id="stationsetpic1" class="fullsizepic">
      <p>
        Since the Station Parameters (green box) are the most frequently adjusted settings, take a few minutes to familiarize yourself with what each of these settings does.
      </p>
      <ol>
        <li><b>Station name:</b> fairly straightforward, this name is what you will use to address this station in workflows. Every station must have a unique name and is case sensitive.</li>
        <li><b>Position X:</b> X-coordinate of the center of the station in the map.</li>
        <li><b>Position Y:</b> Y-coordinate of the center of the station in the map.</li>
        <li><b>Position Angle:</b> sets the station orientation. 0 degrees means the front of the station is facing "up" on the map, negative numbers rotate clockwise and positive numbers rotate counter-clockwise. AGILOX uses only +/- 180 degrees, but you can enter any number up to 360 degrees and the conversion will be performed automatically (i.e. 270 degrees will convert to -90 degrees). Anything beyond 360 will be treated as that number divided by 100, for example, entering 1234 gives 12.34 degrees.</li>
        <li><b>Sort Order:</b> sets the priority for stations in a station area, if you want the stations to be dealt with in a certain order rather than randomly.</li>
        <li><b>Entering Lift Height:</b> raises the forks by this amount before entering the station.</li>
        <li><b>Relative Lift Height:</b> once a station is entered and ready for pickup, raises the forks this additional distance from the current position. Note that when leaving a station, the lift height will then be entering lift height + relative lift height, and the final lift height should be at least 150mm in order to clear the load from the view of the safety sensors.</li>
        <li><b>Pre-position:</b> AGILOX is approaching this point and aligning itself with the station here before entering.</li>
        <li><b>Prepre-position waypoint:</b> A prepre-position will sometimes be calculated automatically, if the pre-position is not in a drive-able area of the map (more on this below). You can also manually specify this point by creating a Waypoint on the map. AGILOX will drive to this point, align itself with the station, and then parallel-drive in whatever direction is necessary to reach the pre-position. This is used for "very narrow aisle" operations, or in any other situation when parallel driving is required to reach the station.</li>
        <li><b>VIA Waypoint:</b> Similar to #9, this is a Waypoint that AGILOX will drive through before driving normally to the prepre-position, or if none is specified, the pre-position.</li>
      </ol>
      <p>
        As mentioned in #9, an important consideration for station placement is the "allowed" driving area on the map. A station can still be placed inside no-driving areas, provided that there is a clear path to an allowed driving area. As shown in the example below, a prepre-position waypoint is automatically created when the pre-position is in a no-driving area.
      </p>
      <img src="images/stationsetpic2.jpg" id="stationsetpic2" class="fullsizepic">
      <p>
        However, it is possible to create a station in such a way that there is no route to the preposition, and therefore the prepre-position cannot be automatically calculated. For example, if you were to rotate this station 180 degrees, so that the front of the vehicle is towards the wall (as you would do when creating a charging station, for instance), you would see this:
      </p>
      <img src="images/stationsetpic3.jpg" id="stationsetpic3" class="fullsizepic">
      <p>
        AGILOX cannot drive to this station, because neither the pre-position nor prepre-position are located in an allowed driving area. The solution to creating this station, is to set a negative value for the pre-position. Of course, there will be certain other situations and station orientations that are simply not possible to accommodate, so keep in mind that if the pre-position is in a no-driving area and a prepre-position waypoint is not automatically created, in some cases it may not be possible to use that particular configuration.
      </p>
      <p class="paragraph-break">
        In this example, -1500 was used for the pre-position instead of the default 1600, which will give you a suitable orientation as shown:
      </p>
      <img src="images/stationsetpic4.jpg" id="stationsetpic4" class="fullsizepic">
      <p>
        Another important consideration for the pre-position is block storage (or deep storage), i.e. having multiple rows of pallets in front of each other. Each "channel" (entry point) of pallets must have the SAME pre-position, that is, the same X-Y coordinate on the map, in order to work properly. This will be done automatically if you follow this procedure:
      </p>
      <ol>
        <li>Create a station area (if you don't already have one).</li>
        <li>Create a new station and assign it to the station area you want to use.</li>
        <li>Ctrl-click and drag this station to create a copy in the X or Y direction. The offset is shown in the tooltip when dragging the new station - make sure either X or Y is at 0mm.</li>
      </ol>
      <img src="images/stationsetpic5.jpg" id="stationsetpic5" class="fullsizepic">
      <p>
        Every new station in a block storage area should be a copy of one of the existing stations. You can create as many "channels" (Here Station1 and Station2 are channel 1, and Station3 and Station4 are channel 2) and rows in this manner as you wish. At least 200mm of space is required between channels. To add additional channels, you should copy the "front" stations, in this case Station1 or Station3. To add additional rows to a channel, copy the back stations away from the front (i.e. copy Station2 to the left, away from Station1). Notice that each station in a channel has it's pre-position set to the exact same point - again, this is set automatically when following the procedure outlined above and should not require modifying any of the station settings.
      </p>
    </section>
    <section class="main-section" id="create-charging-station">
      <header>
        <h1>
          Create a Charging Station
        </h1>
      </header>
      <p>
        <b>This section assumes that a charger with pre-wired charging plate has already been installed. For additional information on this see the charger datasheets and wiring info in the Chargers section of the appendix.</b>
      </p>
      <p>
        A charging station is not much different than any other station, but is probably the most important part of an AGILOX deployment since (at least for the time being) we are still bound by the same laws of physics as everyone else and our vehicles require an external power source in order to run indefinitely. The easiest way to set up a charging station is to drive an AGILOX unit to the location where you want the charging station to be using Manual Mode, and then press one of the emergency stop buttons on the vehicle. Keep in mind that since we are typically driving forwards into a charging station rather than backing in, you must ensure there is enough unobstructed space around the station at all times, as shown below. Also note that these dimensions apply to a euro-pallet (800 x 1200 mm) sized load carrier, and more space will be required for larger load types:
      </p>
      <div class="squarepicsdiv">
        <img src="images/chargepic1.jpg" id="chargepic1" class="squarepic">
      </div>
      <p>
        With the vehicle in place, right click the center of the unit in the HMI and create a new station. Assign a name and set the preposition to -1500 (or your desired distance, depending on the environment). It's important to note that the negative pre-position value creates a typical "forward-entry" station - <b>if you want a reverse-entry charging station, the polarity of the charging plate must be reversed</b> by swapping the large +/- cables (the outermost two).
      </p>
      <p>
        Also make sure that, at a minimum, the "Charging Possible" and "Occupation Detection" options are set in the Station Options, or you can enable all the options as shown:
      </p>
      <div class="squarepicsdiv">
        <img src="images/chargepic2.jpg" id="chargepic2" class="squarepic">
        <img src="images/chargepic3.jpg" id="chargepic3" class="squarepic">
      </div>
      <p>
        Now you can install the charging plate. Simply slide the charging plate under the vehicle so that it is centered under the frame. There are two bolts at the bottom of the frame that you can use as a reference for the center. The vertical surface of the charging plate should also be flush with the outer edge of the frame.
      </p>
      <div class="squarepicsdiv">
        <img src="images/chargepic4.jpg" id="chargepic4" class="rectanglepic">
        <img src="images/chargepic5.jpg" id="chargepic5" class="rectanglepic">
      </div>
      <p>
        With the plate in place, mark the floor around the corners of the plate with a pencil or pieces of masking tape so you don't lose this position during installation. You can now release the emergency stop and drive the vehicle away from the charging station. For testing purposes you can stick the charging plate to the floor with some double-sided tape, or you can proceed directly to permanent mounting. The required mounting hardware is a set of four M8 concrete anchors (with M8x25 hex screw), and holes should be drilled at a diameter of 10mm to a depth of 30mm.
      </p>
    </section>
    <section class="main-section" id="simple-workflow-example">
      <header>
        <h1>
          Simple Workflow Example
        </h1>
      </header>
      <p>
        Let's take a look first at the simplest method of starting a workflow in the HMI. In the toolbar on the left, the third button from the top, "Start Workflow", allows you to manually trigger any workflow which has been defined in the workflow collection (Misc. Tools and Settings >> System Database Editor). Every unit comes with the following prototype workflows by default:
      </p>
      <div class="squarepicsdiv">
        <img src="images/workflowpic1.jpg" id="workflowpic1" class="squarepic">
      </div>
      <div class="twocolumn">
        <p>
          These are fairly self explanatory by the names and pictures. When choosing a workflow through this menu, you will be prompted to choose the values for the variables in the workflow (usually just the source and the destination - more on that later). As an example, when you click to start a Station > Station workflow, you will see prompts similar to the ones shown on the right. By default, this workflow lists all available stations, and stations that belong to an area are sorted under the area name.
        </p>
        <img src="images/workflowpic2.jpg" id="workflowpic2" class="twocolumnpic">
        <img src="images/workflowpic3.jpg" id="workflowpic3" class="twocolumnpic">
      </div>
      <p class="paragraph-break">
        To see how this is implemented, go to Misc. tools and settings > System Database editor and then choose the "workflow" collection on the left side, so that you see the workflow editor as shown below. 
      </p>
      <img src="images/workflowpic4.jpg" id="workflowpic4" class="fullsizepic">
      <p>
        This is the heart of AGILOX commissioning, where all possible work orders are defined. Here you can see the same Station > Station workflow in the previous example. While this may appear overwhelming to anyone not accustomed to writing software at first glance, it's actually quite simple. AGILOX workflows are created in JSON (JavaScript Object Notation), which is essentially just a list of attribute-value pairs. Each "statement" in the workflow is in the form "attribute": "value", and a value can also be another list of attribute-value pairs by using {}. There is not really any logic to implement in the traditional sense: no if/then/else statements, no for/while loops, etc. It's really just a sequentially executed list of orders. To help you visualize this, you can also switch the code editor to "Tree" mode in the top menu bar, which shows you the structure without all of the syntax.
      </p>
      <img src="images/workflowpic5.jpg" id="workflowpic5" class="fullsizepic">
      <p>
        The code and tree editors are functionally identical and you are free to use either. But, once you get the hang of things, you will most likely find the tree view is nice to look at, but cumbersome for creating things compared to the code editor.
      </p>
      <p>
        Every workflow has the same basic structure, and in fact the best way to go about creating custom workflows is to start by copying from these existing basic prototypes and then adding/modifying parameters as necessary until you get the desired result. A complete list of all the things which you can add and change would be far too long to go over here, but you can find this information in section 4.7 of the Commissioning Manual. Just to get the general idea of what you're working with, the simplest possible workflow is shown below.
      </p>
      <img src="images/workflowpic6.jpg" id="workflowpic6" class="fullsizepic">
      <p>
        Every workflow begins with a unique workflow ID ("123" in this case), which is generally a number, but can be any string of alphanumeric characters. This ID is called the Workflow Object, and every Workflow Object is required to contain the "name" and "status" attributes, in addition to the "order" object which contains the body of the workflow. You can give a workflow any name (does not have to be unique), and the status "0" simply means the workflow is enabled - the only other option here is "99" which will disable the workflow and hide it from the list of options shown in the HMI.
      </p>
      <p>
        Every order object must also contain at least one action object, and each action object is processed sequentially according to the action number from lowest to highest. "0" in the example above is the only action object. You could add another action object "1" (or any number, does not have to be consecutive) which specifies an additional action/target pair that makes up the next step in the workflow.
      </p>
      <p class="paragraph-break">
        One final note and you will be well on your way to writing workflows. You will notice that all the prototype workflows have a very similar structure, and define the targets as something like <code>"target": "@SOURCE;Source;station"  or "target": "@DESTINATION;Destination;stationarea"</code>. These are user-input variables, and any time you define such a variable, the HMI will automatically prompt the user to choose the target for that variable when the workflow is started.
      </p>
      <p>
        Variables are defined in the form <code>"@VARIABLENAME;Description;ListOfTargets"</code>. A variable can have any name. Whatever you fill in for Description will appear at the top of the list of targets for that particular variable - this is why you always see the words "source" and "destination" in the user prompts to choose a station that appear with the prototype workflows, but you can rename these to anything you like if you have multiple sources or destinations. Finally, ListOfTargets is the list of stations or areas that are displayed in the user prompt.
      </p>
      <p>
      The default keywords "station" and "stationarea" are generally sufficient since they show everything in their respective categories, but when you have hundreds or thousands of stations it can be easier to view only a specific list of stations. It is possible to create a filtered list of stations and/or areas using regex or by manually listing the stations you want - see section 4.7 of the Commissioning Manual for details.
      </p>
      <p>
        Remember, you are not required to use a variable. If there is no need for the user to choose and you want the workflow to have exactly the same conditions every time it is executed, the target of an action can simply be the name of a station or station area.
      </p>
      <p class="paragraph-break">
        <b>If you've made it this far, you should now have all the knowledge you need to set up and modify your AGILOX system in any way you see fit. The next section will host some more specific commonly used examples for reference, but ultimately the only way to really become proficient with this system is to use it - there is no substitute for experience. Keep frequent software/data backups, and you will be free to play around with it without having to worry about breaking things or losing progress. If you have any questions or suggestions regarding the content of this guide, please contact us at us.support@agilox.net.</b>
      </p>
    </section>
    <section class="main-section" id="advanced-workflow-topics">
      <header>
        <h1>
          Advanced Workflow Topics
        </h1>
      </header>
      <p>
        <b>Coming Soon!</b>
      </p>
  </main>
</body>